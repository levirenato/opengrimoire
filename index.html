<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OpenGrimoire - d&d character sheet</title>
  <link rel="icon" type="image/x-icon" href="./assets/favicon_io/favicon.ico">
  <link
    href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Merriweather:wght@300;400;700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <input type="file" id="import-input" accept=".json" style="display: none;" onchange="importCharacter(this)">

  <div id="dashboard" class="main-container">
    <header class="app-header">
      <img src="./assets/favicon_io/android-chrome-192x192.png" alt="Logo" />
      <h1 class="title-fantasy">OpenGrimoire</h1>
      <p class="subtitle" data-i18n="subtitle">Gerencie seus her√≥is e suas hist√≥rias</p>
      <div class="header-controls">
        <select class="lang-select" onchange="changeLanguage(this.value)">
          <option value="pt-BR">üáßüá∑ PT</option>
          <option value="en-US">üá∫üá∏ EN</option>
        </select>
        <button class="theme-toggle-btn" onclick="toggleGlobalTheme()" title="Alternar Tema Claro/Escuro">
          <span class="material-icons-round" id="theme-icon-home">light_mode</span>
        </button>
      </div>
    </header>
    <button onclick="createNewCharacter()" class="btn-hero neon-effect">
      <span class="material-icons-round">add_circle</span> <span data-i18n="btn_create">Criar Novo Personagem</span>
    </button>
    <div class="char-grid-list" id="character-list"></div>
  </div>

  <div id="sheet-editor" class="sheet-container hidden">
    <nav class="toolbar surface-elevated">
      <div class="nav-left">
        <button class="btn-icon" onclick="closeCharacter()">
          <span class="material-icons-round">arrow_back</span> <span data-i18n="btn_back">Voltar</span>
        </button>
        <select class="lang-select" onchange="changeLanguage(this.value)">
          <option value="pt-BR">üáßüá∑ PT</option>
          <option value="en-US">üá∫üá∏ EN</option>
        </select>
        <button class="btn-icon" onclick="toggleGlobalTheme()" title="Alternar Tema Claro/Escuro">
          <span class="material-icons-round" id="theme-icon-sheet">light_mode</span>
        </button>
      </div>
      <div class="toolbar-actions">
        <button class="btn-secondary" onclick="exportToPDF()">
          <span class="material-icons-round">picture_as_pdf</span> <span data-i18n="btn_export_pdf">PDF</span>
        </button>
        <button class="btn-secondary" onclick="exportCharacter()">
          <span class="material-icons-round">download</span> <span data-i18n="btn_export_json">JSON</span>
        </button>
        <button class="btn-secondary" onclick="document.getElementById('import-input').click()">
          <span class="material-icons-round">upload</span> <span data-i18n="btn_import">Importar</span>
        </button>
        <button class="btn-primary" onclick="saveCharacter()">
          <span class="material-icons-round">save</span> <span data-i18n="btn_save">Salvar</span>
        </button>
        <button class="btn-danger icon-only" onclick="deleteCharacter()">
          <span class="material-icons-round">delete</span>
        </button>
      </div>
    </nav>

    <form id="char-form" class="sheet-layout-new">
      <section class="sheet-header-new surface-elevated">
        <div class="header-top-row">
          <div class="char-portrait-container">
            <div class="portrait-frame-new" onclick="document.getElementById('portrait-upload').click()">
              <img id="char-portrait" src="" alt="Portrait" class="hidden">
              <div id="portrait-placeholder" class="portrait-placeholder-new">
                <span class="material-icons-round">add_a_photo</span>
              </div>
            </div>
            <input type="file" id="portrait-upload" accept="image/*" style="display:none"
              onchange="handlePortraitUpload(event)">
          </div>

          <div class="header-info-group">
            <div class="char-name-wrapper">
              <input type="text" name="charName" class="input-char-name" data-i18n-placeholder="ph_char_name"
                placeholder="Nome do Personagem">
              <div class="char-color-picker-inline">
                <input type="hidden" name="charColor" id="charColorInput">
                <div class="color-dots-inline">
                  <span class="dot" style="background:#b8860b" data-color="#b8860b" onclick="setCharColor('#b8860b')"></span>
                  <span class="dot" style="background:#E7623E" data-color="#E7623E" onclick="setCharColor('#E7623E')"></span>
                  <span class="dot" style="background:#AB6DAC" data-color="#AB6DAC" onclick="setCharColor('#AB6DAC')"></span>
                  <span class="dot" style="background:#91A1B2" data-color="#91A1B2" onclick="setCharColor('#91A1B2')"></span>
                  <span class="dot" style="background:#7A853B" data-color="#7A853B" onclick="setCharColor('#7A853B')"></span>
                  <span class="dot" style="background:#7F513E" data-color="#7F513E" onclick="setCharColor('#7F513E')"></span>
                  <span class="dot" style="background:#51A5C5" data-color="#51A5C5" onclick="setCharColor('#51A5C5')"></span>
                  <span class="dot" style="background:#B59E54" data-color="#B59E54" onclick="setCharColor('#B59E54')"></span>
                </div>
              </div>
            </div>

            <div class="header-meta-grid">
              <div class="meta-field">
                <label data-i18n="lbl_class">Classe</label>
                <input type="text" name="charClass" data-i18n-placeholder="ph_class" placeholder="Classe">
              </div>
              <div class="meta-field">
                <label data-i18n="lbl_level">N√≠vel</label>
                <input type="number" name="level" placeholder="1" class="input-small" oninput="handleLevelChange()">
              </div>
              <div class="meta-field">
                <label data-i18n="lbl_race">Ra√ßa</label>
                <input type="text" name="species" data-i18n-placeholder="ph_race" placeholder="Ra√ßa">
              </div>
              <div class="meta-field">
                <label data-i18n="lbl_bg">Antecedente</label>
                <input type="text" name="background" data-i18n-placeholder="ph_bg" placeholder="Antecedente">
              </div>
              <div class="meta-field">
                <label data-i18n="lbl_subclass">Subclasse</label>
                <input type="text" name="subclass" data-i18n-placeholder="ph_subclass" placeholder="Subclasse">
              </div>
              <div class="meta-field">
                <label data-i18n="lbl_align">Alinhamento</label>
                <input type="text" name="alignment" data-i18n-placeholder="ph_align" placeholder="Alinhamento">
              </div>
            </div>
          </div>
        </div>
      </section>

      <div class="sheet-body-grid">

        <aside class="left-sidebar">
          <div class="attributes-section surface-elevated">
            <div class="attributes-list">
              <div class="attr-item">
                <label data-i18n="attr_str">FOR</label>
                <input type="text" name="str_mod" class="attr-mod" readonly>
                <input type="number" name="str_score" class="attr-score" placeholder="10" oninput="updateModifiers()">
              </div>
              <div class="attr-item">
                <label data-i18n="attr_dex">DES</label>
                <input type="text" name="dex_mod" class="attr-mod" readonly>
                <input type="number" name="dex_score" class="attr-score" placeholder="10" oninput="updateModifiers()">
              </div>
              <div class="attr-item">
                <label data-i18n="attr_con">CON</label>
                <input type="text" name="con_mod" class="attr-mod" readonly>
                <input type="number" name="con_score" class="attr-score" placeholder="10" oninput="updateModifiers()">
              </div>
              <div class="attr-item">
                <label data-i18n="attr_int">INT</label>
                <input type="text" name="int_mod" class="attr-mod" readonly>
                <input type="number" name="int_score" class="attr-score" placeholder="10" oninput="updateModifiers()">
              </div>
              <div class="attr-item">
                <label data-i18n="attr_wis">SAB</label>
                <input type="text" name="wis_mod" class="attr-mod" readonly>
                <input type="number" name="wis_score" class="attr-score" placeholder="10" oninput="updateModifiers()">
              </div>
              <div class="attr-item">
                <label data-i18n="attr_cha">CAR</label>
                <input type="text" name="cha_mod" class="attr-mod" readonly>
                <input type="number" name="cha_score" class="attr-score" placeholder="10" oninput="updateModifiers()">
              </div>
            </div>

            <div class="bonus-inspiration-row">
              <div class="small-box">
                <label data-i18n="lbl_inspiration">Inspira√ß√£o</label>
                <input type="checkbox" name="inspiration" class="check-large">
              </div>
              <div class="small-box">
                <label data-i18n="lbl_prof_bonus">B√¥nus Prof.</label>
                <input type="text" name="profBonus" placeholder="+2">
              </div>
            </div>

            <div class="passive-box">
              <label data-i18n="lbl_passive_perc">Percep√ß√£o Passiva</label>
              <input type="number" name="passivePerception" placeholder="10">
            </div>
          </div>

          <div class="saves-section surface-elevated">
            <h3 class="section-title-small" data-i18n="lbl_saves_title">Resist√™ncias</h3>
            <div class="save-item">
              <label><input type="checkbox" name="save_str_prof"><span data-i18n="save_str">For√ßa</span></label>
              <input type="text" name="save_str_mod" placeholder="+0">
            </div>
            <div class="save-item">
              <label><input type="checkbox" name="save_dex_prof"><span data-i18n="save_dex">Destreza</span></label>
              <input type="text" name="save_dex_mod" placeholder="+0">
            </div>
            <div class="save-item">
              <label><input type="checkbox" name="save_con_prof"><span data-i18n="save_con">Constitui√ß√£o</span></label>
              <input type="text" name="save_con_mod" placeholder="+0">
            </div>
            <div class="save-item">
              <label><input type="checkbox" name="save_int_prof"><span data-i18n="save_int">Intelig√™ncia</span></label>
              <input type="text" name="save_int_mod" placeholder="+0">
            </div>
            <div class="save-item">
              <label><input type="checkbox" name="save_wis_prof"><span data-i18n="save_wis">Sabedoria</span></label>
              <input type="text" name="save_wis_mod" placeholder="+0">
            </div>
            <div class="save-item">
              <label><input type="checkbox" name="save_cha_prof"><span data-i18n="save_cha">Carisma</span></label>
              <input type="text" name="save_cha_mod" placeholder="+0">
            </div>
          </div>

          <div class="skills-section surface-elevated">
            <h3 class="section-title-small" data-i18n="lbl_skills_title">Per√≠cias</h3>
            <div class="skills-scroll">
              <div class="skill-item">
                <label><input type="checkbox" name="skill_acro_prof"><span
                    data-i18n="skill_acro">Acrobacia</span></label>
                <input type="text" name="skill_acro_mod" placeholder="+0">
              </div>
              <div class="skill-item">
                <label><input type="checkbox" name="skill_anim_prof"><span data-i18n="skill_anim">Adestrar
                    Animais</span></label>
                <input type="text" name="skill_anim_mod" placeholder="+0">
              </div>
              <div class="skill-item">
                <label><input type="checkbox" name="skill_arca_prof"><span
                    data-i18n="skill_arca">Arcanismo</span></label>
                <input type="text" name="skill_arca_mod" placeholder="+0">
              </div>
              <div class="skill-item">
                <label><input type="checkbox" name="skill_athl_prof"><span
                    data-i18n="skill_athl">Atletismo</span></label>
                <input type="text" name="skill_athl_mod" placeholder="+0">
              </div>
              <div class="skill-item">
                <label><input type="checkbox" name="skill_perf_prof"><span data-i18n="skill_perf">Atua√ß√£o</span></label>
                <input type="text" name="skill_perf_mod" placeholder="+0">
              </div>
              <div class="skill-item">
                <label><input type="checkbox" name="skill_decp_prof"><span
                    data-i18n="skill_decp">Engana√ß√£o</span></label>
                <input type="text" name="skill_decp_mod" placeholder="+0">
              </div>
              <div class="skill-item">
                <label><input type="checkbox" name="skill_stea_prof"><span
                    data-i18n="skill_stea">Furtividade</span></label>
                <input type="text" name="skill_stea_mod" placeholder="+0">
              </div>
              <div class="skill-item">
                <label><input type="checkbox" name="skill_hist_prof"><span
                    data-i18n="skill_hist">Hist√≥ria</span></label>
                <input type="text" name="skill_hist_mod" placeholder="+0">
              </div>
              <div class="skill-item">
                <label><input type="checkbox" name="skill_inti_prof"><span
                    data-i18n="skill_inti">Intimida√ß√£o</span></label>
                <input type="text" name="skill_inti_mod" placeholder="+0">
              </div>
              <div class="skill-item">
                <label><input type="checkbox" name="skill_insg_prof"><span
                    data-i18n="skill_insg">Intui√ß√£o</span></label>
                <input type="text" name="skill_insg_mod" placeholder="+0">
              </div>
              <div class="skill-item">
                <label><input type="checkbox" name="skill_invs_prof"><span
                    data-i18n="skill_invs">Investiga√ß√£o</span></label>
                <input type="text" name="skill_invs_mod" placeholder="+0">
              </div>
              <div class="skill-item">
                <label><input type="checkbox" name="skill_medi_prof"><span
                    data-i18n="skill_medi">Medicina</span></label>
                <input type="text" name="skill_medi_mod" placeholder="+0">
              </div>
              <div class="skill-item">
                <label><input type="checkbox" name="skill_natu_prof"><span
                    data-i18n="skill_natu">Natureza</span></label>
                <input type="text" name="skill_natu_mod" placeholder="+0">
              </div>
              <div class="skill-item">
                <label><input type="checkbox" name="skill_perc_prof"><span
                    data-i18n="skill_perc">Percep√ß√£o</span></label>
                <input type="text" name="skill_perc_mod" placeholder="+0">
              </div>
              <div class="skill-item">
                <label><input type="checkbox" name="skill_pers_prof"><span
                    data-i18n="skill_pers">Persuas√£o</span></label>
                <input type="text" name="skill_pers_mod" placeholder="+0">
              </div>
              <div class="skill-item">
                <label><input type="checkbox" name="skill_slei_prof"><span
                    data-i18n="skill_slei">Prestidigita√ß√£o</span></label>
                <input type="text" name="skill_slei_mod" placeholder="+0">
              </div>
              <div class="skill-item">
                <label><input type="checkbox" name="skill_reli_prof"><span
                    data-i18n="skill_reli">Religi√£o</span></label>
                <input type="text" name="skill_reli_mod" placeholder="+0">
              </div>
              <div class="skill-item">
                <label><input type="checkbox" name="skill_surv_prof"><span
                    data-i18n="skill_surv">Sobreviv√™ncia</span></label>
                <input type="text" name="skill_surv_mod" placeholder="+0">
              </div>
            </div>
          </div>
        </aside>

        <main class="center-main">
          <div class="combat-row surface-elevated">
            <div class="combat-stat">
              <span class="material-symbols-outlined">shield</span>
              <label data-i18n="lbl_ac">CA</label>
              <input type="number" name="ac" placeholder="10">
            </div>
            <div class="combat-stat">
              <span class="material-symbols-outlined">electric_bolt</span>
              <label data-i18n="lbl_init">Iniciativa</label>
              <input type="text" name="initiative" placeholder="+0">
            </div>
            <div class="combat-stat">
              <span class="material-symbols-outlined">footprint</span>
              <label data-i18n="lbl_speed">Deslocamento</label>
              <input type="text" name="speed" placeholder="9m">
            </div>
          </div>

          <div class="hp-section-new surface-elevated">
            <div class="hp-header">
              <span class="material-symbols-outlined">favorite</span>
              <label data-i18n="lbl_hp_title">Pontos de Vida</label>
            </div>
            <div class="hp-inputs">
              <div class="hp-field">
                <label data-i18n="lbl_hp_max">M√°ximo</label>
                <input type="number" name="hpMax" placeholder="0">
              </div>
              <div class="hp-field hp-current-field">
                <label data-i18n="lbl_hp_curr">Atual</label>
                <input type="number" name="hpCurrent" placeholder="0" class="hp-current-input">
              </div>
              <div class="hp-field">
                <label data-i18n="lbl_hp_temp">Temp</label>
                <input type="number" name="hpTemp" placeholder="0">
              </div>
            </div>
          </div>

          <div class="dice-death-row">
            <div class="hit-dice-box surface-elevated">
              <label data-i18n="lbl_hit_dice">Dados de Vida</label>
              <input type="text" name="hitDiceTotal" placeholder="1d8">
            </div>
            <div class="death-saves-box surface-elevated">
              <label data-i18n="lbl_death_saves">Testes contra Morte</label>
              <div class="death-checks">
                <div class="death-row">
                  <span data-i18n="lbl_success">Sucesso</span>
                  <div class="check-group">
                    <input type="checkbox" name="death_save_success_1"><input type="checkbox" name="death_save_success_2"><input type="checkbox" name="death_save_success_3">
                  </div>
                </div>
                <div class="death-row">
                  <span data-i18n="lbl_fail">Falha</span>
                  <div class="check-group">
                    <input type="checkbox" name="death_save_fail_1"><input type="checkbox" name="death_save_fail_2"><input type="checkbox" name="death_save_fail_3">
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="tabs-wrapper">
            <div class="tabs-header">
              <button type="button" class="tab-button active" onclick="switchTab(event, 'attacks-tab')"
                data-i18n="tab_attacks">Ataques</button>
              <button type="button" class="tab-button" onclick="switchTab(event, 'equipment-tab')"
                data-i18n="tab_equip">Equipamento</button>
              <button type="button" class="tab-button" onclick="switchTab(event, 'features-tab')"
                data-i18n="tab_traits">Tra√ßos</button>
            </div>

            <div id="attacks-tab" class="tab-panel active surface-elevated">
              <label class="tab-label" data-i18n="lbl_attacks_desc">Ataques e Conjura√ß√£o</label>
              <p class="helper-small" data-i18n="hlp_attacks">Nome | B√¥nus | Dano/Tipo</p>
              <textarea name="attacks" rows="8" data-i18n-placeholder="ph_attacks"
                placeholder="Ex: Espada Longa | +5 | 1d8+3 cortante"></textarea>
            </div>

            <div id="equipment-tab" class="tab-panel surface-elevated">
              <div class="coins-row">
                <div class="coin"><label data-i18n="coin_cp">PC</label><input type="number" name="cp" placeholder="0"></div>
                <div class="coin"><label data-i18n="coin_sp">PP</label><input type="number" name="sp" placeholder="0"></div>
                <div class="coin"><label data-i18n="coin_ep">PE</label><input type="number" name="ep" placeholder="0"></div>
                <div class="coin"><label data-i18n="coin_gp">PO</label><input type="number" name="gp" placeholder="0"></div>
                <div class="coin"><label data-i18n="coin_pp">PL</label><input type="number" name="pp" placeholder="0"></div>
              </div>
              <label class="tab-label" data-i18n="lbl_equip">Equipamento</label>
              <textarea name="equipment" rows="10" data-i18n-placeholder="ph_equip"
                placeholder="Liste seus itens..."></textarea>
            </div>

            <div id="features-tab" class="tab-panel surface-elevated">
              <label class="tab-label" data-i18n="lbl_prof_lang">Profici√™ncias e Idiomas</label>
              <textarea name="proficiencies" rows="4" data-i18n-placeholder="ph_prof_lang"
                placeholder="Armaduras, armas, ferramentas, idiomas..."></textarea>
              <label class="tab-label" data-i18n="lbl_feat_traits">Caracter√≠sticas e Talentos</label>
              <textarea name="featuresTraits" rows="10" data-i18n-placeholder="ph_feat_traits"
                placeholder="Descreva suas habilidades especiais..."></textarea>
            </div>
          </div>
        </main>

        <aside class="right-sidebar">
          <div class="spells-section surface-elevated">
            <h3 class="section-title-small" data-i18n="sec_spells">Magias</h3>

            <div class="spell-stats-row">
              <div class="spell-stat-mini">
                <label data-i18n="lbl_spell_ability">Hab.</label>
                <input type="text" name="spellcastingAbility" placeholder="INT">
              </div>
              <div class="spell-stat-mini">
                <label data-i18n="lbl_spell_dc">CD</label>
                <input type="number" name="spellSaveDC" placeholder="13">
              </div>
              <div class="spell-stat-mini">
                <label data-i18n="lbl_spell_atk">Atq.</label>
                <input type="text" name="spellAttackBonus" placeholder="+5">
              </div>
            </div>

            <div class="spell-list" id="spell-list-container">
            </div>
          </div>

          <div class="backstory-section surface-elevated">
            <h3 class="section-title-small" data-i18n="sec_backstory">Hist√≥ria do Personagem</h3>
            <textarea name="backstory" rows="8" data-i18n-placeholder="ph_backstory"
              placeholder="Conte a hist√≥ria do seu personagem..."></textarea>
          </div>
        </aside>
      </div>
    </form>
  </div>

  <footer>
    <small data-i18n="footer_text">Copyright &copy; 2025 created by levirenato.</small>
  </footer>

  <div id="modal-overlay" class="modal-overlay hidden">
    <div class="modal-box">
      <div class="modal-header">
        <span class="material-icons-round modal-icon" id="modal-icon">auto_stories</span>
        <h3 id="modal-title" class="modal-title"></h3>
      </div>
      <p id="modal-message" class="modal-message"></p>
      <div class="modal-actions">
        <button id="modal-cancel" class="btn-secondary modal-btn hidden" onclick="resolveModal(false)"></button>
        <button id="modal-ok" class="btn-primary modal-btn" onclick="resolveModal(true)">OK</button>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
  <script src="language.js"></script>
  <script src="script.js"></script>
  <script src="pdf-exporter.js"></script>
</body>

</html>
